<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Expense</title>
    <link rel="icon" type="image/x-icon" href="asstes/images/favicon/favicon-icon.png">

    <!-- <link href="asstes/library/bootstrap-4.0.0/bootstrap.min.css" rel="stylesheet"> -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="asstes/library/Easy-Page-Element-Loader-Plugin-with-jQuery-loader-js/jquery.loader.css"
        rel="stylesheet">
    <link href="asstes/css/style.css" rel="stylesheet">
    <link href="asstes/css/general.css" rel="stylesheet">
    <link href="asstes/css/expense.css" rel="stylesheet">
    <link href="asstes/css/view-calculated-expense.css" rel="stylesheet">
    <style>
        .coll-first {
            padding-right: 10px;
        }
    </style>
    <script src="asstes/library/jquery-3.6.4.js"></script>
    <script src="asstes/library/bootstrap-4.0.0/bootstrap.min.js"></script>
    <script src="asstes/library/bootstrap-4.0.0/bootstrap.bundle.min.js"></script>
    <script src="asstes/library/Easy-Page-Element-Loader-Plugin-with-jQuery-loader-js/jquery.loader.js"></script>
    <script src="asstes/js/variable.js"></script>
    <script src="asstes/js/general.js"></script>
    <script src="asstes/js/validation-session.js"></script>
    <script src="asstes/js/import-header-footer.js"></script>

</head>

<body>
    <br>

    <section class="form-section">
        <div class="container">
            <div class="row">
                <div class="col-sm-12 col-md-10 col-lg-6 mx-auto">
                    <div class="card border-0 shadow rounded">
                        <div class="card-body p-4 p-sm-5">
                            <h5 class="card-title text-center mb-5 font-weight-light fs-5">View Calculate Expenses</h5>
                            <div class="duration">
                                <b>Duration : </b>
                                <u><span id="startDate">dd-mm-yyyy</span></u> To <u><span
                                        id="endDate">dd-mm-yyyy</span></u>
                            </div><br>
                            <div class="total-exp-field">
                                <b>Total Expenses : </b>
                                <span id="total-exp">00.00</span>
                            </div><br>
                            <form id="formId">
                                <fieldset class="form-group border p-3">
                                    <!-- <legend class="w-auto px-2">Variable Expenses</legend> -->
                                    <div class="input-group mb-3">
                                        <div class="form-group col-md-6 coll-first">
                                            <label for="fullPersons">Full Month Persons</label>
                                            <input type="number" class="form-control" name="fullPersons"
                                                id="fullPersons" value="0" disabled>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="fullPersonPerhead">Full Person Perhead</label>
                                            <input type="number" class="form-control" name="fullPersonPerhead"
                                                id="fullPersonPerhead" value="0" disabled>
                                        </div>
                                    </div>
                                    <div class="input-group mb-3">
                                        <div class="form-group col-md-6 coll-first">
                                            <label for="halfPersons">Half Month Persons</label>
                                            <input type="number" class="form-control" name="halfPersons"
                                                id="halfPersons" value="0" disabled>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="halfPersonPerhead">Half Person Perhead</label>
                                            <input type="number" class="form-control" name="halfPersonPerhead"
                                                id="halfPersonPerhead" value="0" disabled>
                                        </div>
                                    </div>
                                    <div class="input-group mb-3">
                                        <div class="form-group col-md-6 coll-first">
                                            <label for="vacationPersons">Persons on Vacation</label>
                                            <input type="number" class="form-control" name="vacationPersons"
                                                id="vacationPersons" value="0" disabled>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="vacationPersonPerhead">Persons on Vacatio Perhead</label>
                                            <input type="number" class="form-control" name="vacationPersonPerhead"
                                                id="vacationPersonPerhead" value="0" disabled>
                                        </div>
                                    </div>
                                </fieldset>
                                <fieldset>

                                    <table class="table my-2 text-center" id="user-table">
                                        <thead class="bg-primary">
                                            <tr>
                                                <th scope="col">Persone Name</th>
                                                <th scope="col">Calculate Per Head </th>
                                                <th scope="col">Monthly My Expenses </th>
                                                <th scope="col">Totle Amount </th>
                                            </tr>
                                        </thead>
                                        <tbody id="persone-expense-data">

                                        </tbody>
                                    </table>
                                </fieldset>
                                <br>
                                <div class="d-grid">
                                    <a class="btn btn-primary text-uppercase font-weight-bold"
                                        href="calculate-expense.html">Back</a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <script>
        var result = JSON.parse(localStorage.getItem('result'));
      
        if (result == null || result == '') {
            showToast("Expense calculation is not done", 'error');
            console.log("error passed");
        }
        else {
           
            showToast(result.message, 'success');
            var userCalculateExpense = "";
            var userCalculateExpenseObject = result.data.persons;
            var fullperson = 0,halfperson =0, onvacationperson =0, fullPeesonPerHead = 0,halfpersonPerHead = 0,onvacationpersonPerHead = 0;
            console.log("first step");
            userCalculateExpenseObject.forEach(element => {
                switch (element.personType) {
                    case "Full": fullperson++;
                        fullPeesonPerHead += element.totalPayableAmount;
                        break;
                    case "Half": halfperson++;
                        halfpersonPerHead += element.totalPayableAmount;
                        break;
                    case "OnVacation": onvacationperson++;
                        onvacationpersonPerHead += element.totalPayableAmount;
                        break;
                }
            });
            console.log("seccond step");
            userCalculateExpenseObject.forEach(element => {
                userCalculateExpense += `
                                        <tr>
                                            <td scope="col">${element.person.fullName}</td>
                                            <td scope="col">${element.totalCalcualtedMonthlyAmount}</td>
                                            <td scope="col">${element.totalMyMonthlyAmount}</td>
                                            <td scope="col">${element.totalPayableAmount}</td>
                                        </tr>
        `
            });
            console.log("third step");
            var formDate = new Date(result.data.from).toLocaleString();
            var toDate = new Date(result.data.to).toLocaleString();
            var totalExpeses = result.data.totalAmount;
            console.log("fore step");
            $("#startDate").text(formDate);
            $("#endDate").text(toDate);
            $("#total-exp").text(totalExpeses);
            $("#persone-expense-data").append(userCalculateExpense);
            $("#fullPersons").val(fullperson);
            $("#fullPersonPerhead").val(fullPeesonPerHead);
            $("#halfPersons").val(halfperson);
            $("#halfPersonPerhead").val(halfpersonPerHead);
            $("#vacationPersons").val(onvacationperson);
            $("#vacationPersonPerhead").val(onvacationpersonPerHead);
            console.log("fivth step");
        }
    </script>
    <script type="text/javascript" src="asstes/js/expense-api-call.js"></script>

</body>

</html>